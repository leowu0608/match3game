var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(o){n=[6,o],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},SoundEvent=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.index=n,r.playingSound=o,r}return __extends(t,e),t}(egret.Event);__reflect(SoundEvent.prototype,"SoundEvent"),window.SoundEvent=SoundEvent;var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function r(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.replace(".exml","_EUI.json");generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(s,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(o,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameController=function(e){function t(){var t=e.call(this)||this;return t.isPlaying=!1,t.isLock=!1,t.isMatchLock=!1,t.sourceItemData=new BoardItemData,t.targetItemData=new BoardItemData,t.boardItemPool=[],t.boardItemDataPool=[],t.model=new GameModel,t}return __extends(t,e),Object.defineProperty(t.prototype,"maxLevel",{get:function(){return this.model.maxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMaxLevel",{get:function(){return this.model.isMaxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMaxLevelPass",{get:function(){return this.model.isMaxLevelPass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLevel",{get:function(){return this.model.currentLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLevelData",{get:function(){return this.model.currentLevelData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetScore",{get:function(){return this.model.currentLevelData.target},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentScore",{get:function(){return this.model.currentScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainTime",{get:function(){return this.model.remainTime},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.model=new GameModel},t.prototype.parseData=function(){this.parseLevelData(),this.loadSavedLevel()},t.prototype.loadSavedLevel=function(){var e,t=egret.localStorage.getItem("currentLevel");t&&(e=JSON.parse(t)),e||(e={level:1,isPass:!1}),this.model.setLevelStatus(e.level,e.isPass),e.level==this.model.maxLevel?this.model.setCurrentLevel(e.level):e.isPass?this.model.setCurrentLevel(e.level+1):this.model.setCurrentLevel(e.level)},t.prototype.saveCurrentLevel=function(){var e=this.model.currentLevelData,t={level:e.level,isPass:e.isPass};egret.localStorage.setItem("currentLevel",JSON.stringify(t))},t.prototype.parseLevelData=function(){var e=RES.getRes("levels_json"),t=this.model,n=1;e.forEach(function(e){t.addLevelData(new LevelData(e.level,e.target,e.time)),n=Math.max(n,e.level)}),t.setMaxLevel(n)},t.prototype.resetLevel=function(){this.model.resetLevel(),this.saveCurrentLevel()},t.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e=this,e.isPlaying?[2]:(e.isPlaying=!0,SoundUtils.playBGM("bgm_2",this.hashCode,!0),t=ProcessController.instance.ui.getUI(3),t&&t.updateLevel(),e.model.setStartTime(egret.getTimer()),t&&t.updateTimeLimit(),n=setInterval(function(){t&&t.updateTimeLimit(),e.model.isTimeOut&&e.onGameResult(e.model.currentLevel,!1)},500),e.model.setTimeId(n),e.createBoardItemDatas(),[4,e.matchItems(!0)]);case 1:return o.sent(),[2]}})})},t.prototype.createBoardItemDatas=function(){for(var e=0;9>e;e++)for(var t=0;9>t;t++)this.createBoardItemData(e,t);var n=ProcessController.instance.ui.getUI(3);n&&n.createBoardItems()},t.prototype.createBoardItemData=function(e,t){var n=9*e+t,o=Math.ceil(5*Math.random()),r=new BoardItemData;r.updateData(n,e,t,o),this.model.addBoardItemData(r)},t.prototype.stopGame=function(){this.isPlaying&&(this.isPlaying=!1,this.clearTimeId())},t.prototype.clearGame=function(){var e=ProcessController.instance.ui.getUI(3);this.isLock=!1,this.isMatchLock=!1,this.clearTimeId(),this.model.clearScore(),e&&e.updateScore(),this.model.setStartTime(0),e&&e.updateTimeLimit(),this.disposeBoardItemDatas()},t.prototype.onGameResult=function(e,t){SoundUtils.playSound(t?"win_01":"lose_01",this.hashCode),this.stopGame(),this.model.setLevelStatus(e,t),e==this.model.maxLevel?this.model.setCurrentLevel(e):t?this.model.setCurrentLevel(e+1):this.model.setCurrentLevel(e),this.saveCurrentLevel(),ProcessController.instance.ui.showUI(4,!1);var n=ProcessController.instance.ui.getUI(4);n&&n.setResultData(e,t)},t.prototype.clearTimeId=function(){this.model.timeId&&(clearInterval(this.model.timeId),this.model.setTimeId(0))},t.prototype.getBoardItemData=function(e){return this.model.getBoardItemData(e)},t.prototype.matchItems=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var t,n,o,r;return __generator(this,function(i){switch(i.label){case 0:t=!1,i.label=1;case 1:return n=this.checkMatches(),n.length<=0?[3,4]:(t=!0,e||(o=3==n.length?1:4==n.length?2:3,this.model.addScore(o),r=ProcessController.instance.ui.getUI(3),r&&r.updateScore()),SoundUtils.playSound("match_01",this.hashCode),this.checkHasSpecialMatch(n)&&SoundUtils.playSound("special_01",this.hashCode),[4,this.processMatches(n)]);case 2:return i.sent(),[4,this.dropItems()];case 3:return i.sent(),[3,1];case 4:return[2,t]}})})},t.prototype.checkHasSpecialMatch=function(e){for(var t=0;t<e.length;t++){for(var n=this.getBoardItemData(e[t]),o=1,r=n.col-1;r>=0;r--){var i=9*n.row+r;if(e.indexOf(i)<0)break;var a=this.getBoardItemData(i);if(a.color!=n.color)break;o++}for(var s=n.col+1;9>s;s++){var i=9*n.row+s;if(e.indexOf(i)<0)break;var l=this.getBoardItemData(i);if(l.color!=n.color)break;o++}for(var u=n.row-1;u>=0;u--){var i=9*u+n.col;if(e.indexOf(i)<0)break;var c=this.getBoardItemData(i);if(c.color!=n.color)break;o++}for(var d=n.row+1;9>d;d++){var i=9*d+n.col;if(e.indexOf(i)<0)break;var h=this.getBoardItemData(i);if(h.color!=n.color)break;o++}if(o>=5)return!0}return!1},t.prototype.processMatches=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n){function o(){var t=!0;e.forEach(function(e){a[e]||(t=!1)}),t&&(e.forEach(function(e){var t=i.getBoardItemData(e),n=t.boardItem;t.clearBoardItem(),i.disposeBoardItem(n)}),n())}function r(e){a[e]=!0,o()}for(var i=t,a={},s=0;s<e.length;s++){var l=e[s],u=t.getBoardItemData(l);egret.Tween.removeTweens(u.boardItem.icon),egret.Tween.get(u.boardItem.icon).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(r.bind(t,l))}})]})})},t.prototype.swapBoardItem=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var o,r,i,a;return __generator(this,function(s){switch(s.label){case 0:return!this.isPlaying||this.isLock?[2]:(o=this.getBoardItemData(e))?(r=9*t+n,(i=this.getBoardItemData(r))&&this.isAdjacent(o,i)?(this.isLock=!0,this.sourceItemData.updateData(o.idx,o.row,o.col,o.color),this.sourceItemData.updateBoardItem(o.boardItem),this.targetItemData.updateData(i.idx,i.row,i.col,i.color),this.targetItemData.updateBoardItem(i.boardItem),SoundUtils.playSound("move_01",this.hashCode),[4,this.swapItems(o,i)]):[2]):[2];case 1:return s.sent(),[4,this.matchItems()];case 2:return(a=s.sent())?[3,4]:(SoundUtils.playSound("move_error_01",this.hashCode),[4,this.swapItems(i,o)]);case 3:s.sent(),s.label=4;case 4:return this.isLock=!1,this.sourceItemData.clear(),this.targetItemData.clear(),this.checkScore(),[2]}})})},t.prototype.checkScore=function(){this.model.isPassLevel&&this.onGameResult(this.model.currentLevel,!0)},t.prototype.isAdjacent=function(e,t){return 1===Math.abs(e.row-t.row)&&e.col===t.col||1===Math.abs(e.col-t.col)&&e.row===t.row},t.prototype.swapItems=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(o){return[2,new Promise(function(o){function r(){i&&a&&(e.boardItem.data=e,t.boardItem.data=t,o())}e.updateColor(n.targetItemData.color),e.updateBoardItem(n.targetItemData.boardItem),t.updateColor(n.sourceItemData.color),t.updateBoardItem(n.sourceItemData.boardItem);var i=!1,a=!1;egret.Tween.get(e.boardItem).to({x:t.boardItem.x,y:t.boardItem.y},200).call(function(){i=!0,r()}),egret.Tween.get(t.boardItem).to({x:e.boardItem.x,y:e.boardItem.y},200).call(function(){a=!0,r()})})]})})},t.prototype.checkMatches=function(){for(var e=[],t=0;9>t;t++)for(var n=0;7>n;n++){var o=9*t+n,r=this.getBoardItemData(o),i=this.getBoardItemData(o+1),a=this.getBoardItemData(o+2);r.color>0&&r.color===i.color&&r.color===a.color&&(-1===e.indexOf(r.idx)&&e.push(r.idx),-1===e.indexOf(i.idx)&&e.push(i.idx),-1===e.indexOf(a.idx)&&e.push(a.idx))}for(var n=0;9>n;n++)for(var t=0;7>t;t++){var o=9*t+n,r=this.getBoardItemData(o),i=this.getBoardItemData(o+9),a=this.getBoardItemData(o+18);r.color>0&&r.color===i.color&&r.color===a.color&&(-1===e.indexOf(r.idx)&&e.push(r.idx),-1===e.indexOf(i.idx)&&e.push(i.idx),-1===e.indexOf(a.idx)&&e.push(a.idx))}return e},t.prototype.disposeBoardItemDatas=function(){var e=this.model.boardItemDatas;for(var t in e){var n=e[t];delete e[t];var o=n.boardItem;n.dispose(),this.disposeBoardItem(o)}},t.prototype.createBoardItem=function(){return this.boardItemPool.length>0?this.boardItemPool.pop():new BoardItem},t.prototype.disposeBoardItem=function(e){e&&(e.dispose(),this.boardItemPool.push(e))},t.prototype.dropItems=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t){function n(){s&&l&&t()}function o(){for(var e=!0,t=0;t<u.length;t++){var o=u[t];if(!v[o.idx]){e=!1;break}}e&&(s=!0,n())}function r(e,t){v[e.idx]=!0,t.boardItem.y=64*t.row,t.boardItem.data=t,o()}function i(){for(var e=!0,t=0;t<c.length;t++){var o=c[t];if(!L[o.idx]){e=!1;break}}e&&(l=!0,n())}function a(e){L[e.idx]=!0,e.boardItem.data=e,i()}for(var s=!1,l=!1,u=[],c=[],d=0;9>d;d++){for(var h=8,p=8;p>=0;p--){var f=9*p+d,m=e.getBoardItemData(f);m.color>0&&(p!==h&&u.push({idx:f,trow:h,tcol:d}),h--)}for(var p=h;p>=0;p--)c.push({idx:9*p+d,row:p,col:d,emptyRow:h})}for(var v={},g=0;g<u.length;g++){var y=u[g],m=e.getBoardItemData(y.idx),_=m.color,b=m.boardItem,S=9*y.trow+y.tcol,I=e.getBoardItemData(S);I.updateColor(_),I.updateBoardItem(b),m.clearBoardItem(),egret.Tween.removeTweens(b),egret.Tween.get(b).to({y:64*I.row},200).call(r.bind(e,m,I))}0==u.length&&(s=!0,n());for(var L={},C=ProcessController.instance.ui.getUI(3),g=0;g<c.length;g++){var P=c[g],m=e.getBoardItemData(P.idx),_=Math.ceil(5*Math.random());m.updateColor(_),C&&C.createBoardItem(m.row,m.col),m.boardItem.x=64*m.col,m.boardItem.y=64*(m.row-(P.emptyRow+1)),egret.Tween.removeTweens(m.boardItem),egret.Tween.get(m.boardItem).to({y:64*m.row},200).call(a.bind(e,m))}})]})})},t}(egret.HashObject);__reflect(GameController.prototype,"GameController");var ProcessController=function(e){function t(){var t=e.call(this)||this;return t.version="1.0.0",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.root=e,SoundUtils.initialize(),this.ui=new UIController,this.game=new GameController,this.ui.initialize(e),this.game.initialize(),[4,this.loadResources()];case 1:return t.sent(),this.game.parseData(),this.ui.showUI(2,!0),[2]}})})},t.prototype.loadResources=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.ui.showUI(1,!0),e=this.ui.getUI(1),[4,RES.loadGroup("config",0,e)];case 1:return t.sent(),[4,RES.loadGroup("login",0,e)];case 2:return t.sent(),[4,RES.loadGroup("game",0,e)];case 3:return t.sent(),[4,RES.loadGroup("sound",0,e)];case 4:return t.sent(),[2]}})})},t.prototype.resetLevel=function(){if(this.game.isMaxLevelPass){this.game.resetLevel();var e=this.ui.getUI(2);e&&e.updateCurrentLevelLabel()}},t.prototype.startGame=function(){this.game.isMaxLevelPass||(this.ui.showUI(3,!0),this.game.startGame())},t.prototype.nextLevel=function(){this.game.isMaxLevelPass||(this.ui.closeUI(4),this.game.clearGame(),this.game.startGame())},t.prototype.replayGame=function(){this.game.isMaxLevelPass||(this.ui.closeUI(4),this.game.clearGame(),this.game.startGame())},t.prototype.exitGame=function(){this.game.isMaxLevelPass&&(this.game.clearGame(),SoundUtils.playBGM("bgm_1",this.hashCode,!0),this.ui.showUI(2,!0))},t}(egret.HashObject);__reflect(ProcessController.prototype,"ProcessController");var UIController=function(){function e(){this.uis={}}return e.prototype.initialize=function(e){this.root=e},e.prototype.getUI=function(e){return this.uis[e]},e.prototype.showUI=function(e,t){void 0===t&&(t=!1),t&&this.closeAllUI();var n=this.uis[e];if(!n){switch(e){case 1:n=new LoadingUI;break;case 2:n=new LoginUI;break;case 3:n=new GameUI;break;case 4:n=new ResultUI;break;default:throw new Error("未知的UI类型")}this.uis[e]=n}n&&!n.parent&&(this.root.addChild(n),n.updateUI&&n.updateUI())},e.prototype.closeUI=function(e){var t=this.uis[e];t&&t.parent&&t.parent.removeChild(t)},e.prototype.closeAllUI=function(){for(var e in this.uis)this.closeUI(+e)},e}();__reflect(UIController.prototype,"UIController");var BoardItemData=function(){function e(){this.idx=0,this.row=0,this.col=0,this.color=0,this.boardItem=null}return e.prototype.updateData=function(e,t,n,o){this.idx=e,this.row=t,this.col=n,this.color=o},e.prototype.updateColor=function(e){this.color=e},e.prototype.updateBoardItem=function(e){this.boardItem=e},e.prototype.clearBoardItem=function(){this.color=0,this.boardItem=null},e.prototype.clear=function(){this.idx=0,this.row=0,this.col=0,this.color=0,this.boardItem=null},e.prototype.dispose=function(){this.clear()},e}();__reflect(BoardItemData.prototype,"BoardItemData");var LevelData=function(){function e(e,t,n){this.isPass=!1,this.level=e,this.target=t,this.time=n,this.isPass=!1}return e}();__reflect(LevelData.prototype,"LevelData");var PlayingSound=function(e){function t(){var t=e.call(this)||this;return t._settingRate=1,t._volumeRate=1,t._position=0,t.hcode=-1,t.callback=null,t.delTime=0,t.delay=3e3,t.regTime=0,t}return __extends(t,e),t.prototype.initialize=function(e,t,n,o,r,i,a,s){void 0===o&&(o=!1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===s&&(s=null);var l=this;l._url=e,l._sound=n,l._loop=o,l._initialVolume=NumberUtils.limit(r||0,0,1),l._volume=l._initialVolume,l._settingRate=i,l._volumeRate=a,l.hcode=t,l.callback=s,l.regTime=Date.now()},Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._sound.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop!=e&&(this._loop=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return null!=this._channel},set:function(e){e?this.play():this.stop()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._channel?this._channel.position:this._position},set:function(e){var t=this;t._channel?t.play(e||0):t._position=NumberUtils.limit(e||0,0,t._sound.length)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialVolume",{get:function(){return this._initialVolume},set:function(e){this._initialVolume=NumberUtils.limit(e||0,0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){e=NumberUtils.limit(e||0,0,1),this._volume!=e&&(this._volume=e,this.updateTransform())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settingRate",{get:function(){return this._settingRate},set:function(e){e=NumberUtils.limit(e||0,0,1),this._settingRate!=e&&(this._settingRate=e,this.updateTransform())},enumerable:!0,configurable:!0}),t.prototype.setSettingRate=function(e,t){void 0===t&&(t=0),e=NumberUtils.limit(e||0,0,1),this._settingRate!=e&&(this._settingRate=e,this.updateTransform(t))},Object.defineProperty(t.prototype,"volumeRate",{get:function(){return this._volumeRate},set:function(e){e=NumberUtils.limit(e||0,0,1),this._volumeRate!=e&&(this._volumeRate=e,this.updateTransform())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mute",{get:function(){return this._mute},set:function(e){this._mute!=e&&(this._mute=e,this.updateTransform())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"soundVolume",{get:function(){var e,t=this;return e=t._mute?0:t._volume*t._settingRate*t._volumeRate},enumerable:!0,configurable:!0}),t.prototype.setVolumeRate=function(e,t){void 0===t&&(t=0),e=NumberUtils.limit(e||0,0,1),this._volumeRate!=e&&(this._volumeRate=e,this.updateTransform(t))},t.prototype.play=function(e,t){void 0===e&&(e=0/0),void 0===t&&(t=0);var n=this;if(n.clearFade(),n._channel){if(isNaN(e))return;n.clearChannel()}if(n._sound){isNaN(e)||(n._position=NumberUtils.limit(e,0,n._sound.length-1));try{n._channel=n._sound.play(n._position,1)}catch(o){console.error("PlayingSound.play error：",o)}n._channel&&(n.updateTransform(),n._channel.addEventListener(egret.Event.SOUND_COMPLETE,n.onSoundComplete,n),t>0?(n.volume=0,n.fadeVolume(n.initialVolume,t)):n.volume=n.initialVolume)}},t.prototype.stop=function(e,t,n,o){void 0===e&&(e=!1),void 0===t&&(t=0),void 0===n&&(n=!1);var r=this;if(r.clearFade(),r._channel){if(t>0)return void r.fadeVolume(0,t,Functor.functor(r.stop,r,e,0,n,o));r._position=e?0:r._channel.position,r.clearChannel()}else e&&(r._position=0);n&&r.finishCallback(),o&&o()},t.prototype.setVolume=function(e,t){void 0===t&&(t=0),this.initialVolume=e,this.fadeVolume(e,t)},t.prototype.fadeVolume=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=null);var o=this;o.clearFade(),e=NumberUtils.limit(e||0,0,1),o._channel&&t>0?(o._fadeCallback=n,o._fadeTween=egret.Tween.get(o),o._fadeTween.to({volume:e},1e3*t),o._fadeTween.call(o.clearFade,o)):(o.volume=e,n&&n())},t.prototype.clearFade=function(){var e=this;e._fadeTween&&(egret.Tween.removeTweens(e),e._fadeTween=null,null!=e._fadeCallback&&(e._fadeCallback(),e._fadeCallback=null))},t.prototype.updateTransform=function(e){void 0===e&&(e=0);var t=this;e>0?t._channel&&!t._channel.isStopped&&egret.Tween.get(t._channel).to({volume:t.soundVolume},1e3*e):t._channel&&!t._channel.isStopped&&(t._channel.volume=t.soundVolume)},t.prototype.clearChannel=function(){var e=this;e._channel&&(egret.Tween.removeTweens(e._channel),e._channel.stop(),e._channel.removeEventListener(egret.Event.SOUND_COMPLETE,e.onSoundComplete,e),e._channel=null)},t.prototype.onSoundComplete=function(e){var t=this,n=null==t._fadeCallback;t.clearFade(),t._position=0,t.clearChannel(),t.dispatchEvent(new egret.Event(egret.Event.SOUND_COMPLETE)),t.finishCallback(),n&&t.loop&&t.play()},t.prototype.finishCallback=function(){var e=this.callback;this._loop||null==e||(this.callback=null,e())},t.prototype.destroy=function(){var e=this;e._fadeTween&&(egret.Tween.removeTweens(e),e._fadeTween=null),e._fadeCallback=null,e._channel&&(egret.Tween.removeTweens(e._channel),e._channel.removeEventListener(egret.Event.SOUND_COMPLETE,e.onSoundComplete,e),e._channel=null),e._sound&&(e._sound.close(),e._sound=null),e.callback=null},t}(egret.EventDispatcher);__reflect(PlayingSound.prototype,"PlayingSound"),window.PlayingSound=PlayingSound;var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){SoundUtils.onAppPause()},egret.lifecycle.onResume=function(){SoundUtils.onAppResume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.startGame(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return t.sent(),[4,this.loadTheme()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),console.error(e),[3,4];case 4:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.startGame=function(){ProcessController.instance.initialize(this)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var SoundPlayer=function(e){function t(t){var n=e.call(this)||this;return n._channel=0,n._settingRate=1,n._volumeRate=1,n._mute=!1,n._channel=t,n._playingList=new Array,n}return __extends(t,e),Object.defineProperty(t.prototype,"channel",{get:function(){return this._channel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playingList",{get:function(){return this._playingList.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"soundCount",{get:function(){return this._playingList.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settingRate",{get:function(){return this._settingRate},set:function(e){this.setSettingRate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumeRate",{get:function(){return this._volumeRate},set:function(e){this.setVolumeRate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mute",{get:function(){return this._mute},set:function(e){this.setMute(e)},enumerable:!0,configurable:!0}),t.prototype.setSettingRate=function(e,t){void 0===t&&(t=0),e=NumberUtils.limit(e||0,0,1),this._settingRate=e;for(var n=0,o=this._playingList;n<o.length;n++){var r=o[n];r.setSettingRate(e,t)}},t.prototype.setVolumeRate=function(e,t){void 0===t&&(t=0),e=NumberUtils.limit(e||0,0,1),this._volumeRate=e;for(var n=0,o=this._playingList;n<o.length;n++){var r=o[n];r.setVolumeRate(e,t)}},t.prototype.setMute=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=0),this._mute!=e){this._mute=e;for(var n=this._playingList.length;n--;)this._playingList[n].mute=e}},t.prototype.playSound=function(e,n,o,r,i,a,s){var l=this;if(!o||l.mute)return t.setChannelCurrentCount(l.channel,-1),null;var u=new PlayingSound;return u.initialize(e,n,o,i,r,l._settingRate,l._volumeRate,s),u.mute=this._mute,u.play(0,a),u.isPlaying&&(u.addEventListener(egret.Event.SOUND_COMPLETE,l.onSoundComplete,l),l._playingList.push(u),l.dispatchEvent(new SoundEvent("addPlayingSound",l._playingList.length-1,u))),u},t.prototype.playPlayingSound=function(e,n,o,r,i,a){var s=this;return!n||s.mute?(t.setChannelCurrentCount(s.channel,-1),null):(n.loop=r,n.hcode=e,n.callback=a,n.settingRate=s._settingRate,n.volumeRate=s._volumeRate,n.setVolume(o),n.play(0,i),n.isPlaying&&(n.addEventListener(egret.Event.SOUND_COMPLETE,s.onSoundComplete,s),s._playingList.push(n),s.dispatchEvent(new SoundEvent("addPlayingSound",s._playingList.length-1,n))),n)},t.prototype.stopSound=function(e,t,n,o){void 0===e&&(e=null),void 0===t&&(t=0/0),void 0===n&&(n=0),void 0===o&&(o=!1);for(var r=this._playingList.concat(),i=0,a=r;i<a.length;i++){var s=a[i];if((null==e||s.url==e)&&(isNaN(t)||s.hcode==t)){var l=this.removePlayingSound.bind(this,s);s.stop(!0,n,o,l)}}},t.prototype.changeSoundLoop=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0/0),void 0===n&&(n=!1);for(var o=this._playingList.concat(),r=0,i=o;r<i.length;r++){var a=i[r];(null==e||a.url==e)&&(isNaN(t)||a.hcode==t)&&(a.loop=n)}},t.prototype.pauseSound=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0/0),void 0===n&&(n=0);for(var o=this._playingList,r=0,i=o;r<i.length;r++){var a=i[r];(null==e||a.url==e)&&(isNaN(t)||a.hcode==t)&&a.stop(!1,n)}},t.prototype.resumeSound=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0/0),void 0===n&&(n=0);for(var o=this._playingList,r=0,i=o;r<i.length;r++){var a=i[r];(null==e||a.url==e)&&(isNaN(t)||a.hcode==t)&&a.play(0/0,n)}},t.prototype.removePlayingSound=function(e,n){void 0===n&&(n=!1);var o=this;e.removeEventListener(egret.Event.SOUND_COMPLETE,o.onSoundComplete,o),e.isPlaying&&e.stop();var r=o._playingList,i=r.indexOf(e);-1!=i&&(t.setChannelCurrentCount(o.channel,-1),r.splice(i,1)),n||(e.dispatchEvent(new egret.Event(egret.Event.REMOVED)),o.dispatchEvent(new SoundEvent("removePlayingSound",i,e))),t.addPlayingSoundCache(e)},t.prototype.onSoundComplete=function(e){var t=this,n=e.target,o=t._playingList,r=o.indexOf(n);(!n.loop||0>r)&&(n.loop=!1,0>r?n.removeEventListener(egret.Event.SOUND_COMPLETE,t.onSoundComplete,t):t.removePlayingSound(n))},t.prototype.getPlayingSound=function(e){for(var t,n=this._playingList,o=n.length,r=o-1;r>=0;r--)if(t=this._playingList[r],t.url==e)return t;return null},t.prototype.getOldestPlayingSound=function(){for(var e,t=this._playingList,n=t.length,o=0/0,r=void 0,i=n-1;i>=0;i--)e=this._playingList[i],e&&(isNaN(o)?(o=e.regTime,r=e):o>e.regTime&&(o=e.regTime,r=e));return r},t.removePlayingSoundOldest=function(){var e,n=t._soundPlayers;for(var o in n)if(2!=+o&&(e=n[o])){var r=e.getOldestPlayingSound();if(r){e.removePlayingSound(r);break}}},t.prototype.isSoundPlaying=function(e){for(var t=this._playingList,n=0,o=t;n<o.length;n++){var r=o[n];if(r.url==e)return!0}return!1},t.initialize=function(e){void 0===e&&(e=15),this.maxLimitCount=e},t.setChannelLimitCount=function(e,t){this._channelLimitCounts[e]=t},t.setChannelCurrentCount=function(e,t){var n=this.curSoundCount;this.curSoundCount=Math.max(0,n+t);var o=this._channelCurCounts,r=o[e]||0;r=Math.max(0,r+t),o[e]=r},t.isChannelSoundLimit=function(e){var t=this._channelLimitCounts[e]||1,n=this._channelCurCounts[e]||0;return n>=t},t.getPlayer=function(e){var n=this._soundPlayers,o=n[e];return o||(o=new t(e),n[e]=o),o},t.registerSound=function(e,t,n,o,r,i,a,s){void 0===o&&(o=1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=0),void 0===s&&(s=null);var l=this,u=l.getPlayer(e);i&&u.stopSound(null,0/0,0,!0),(l.curSoundCount>=l.maxLimitCount||l.isChannelSoundLimit(e))&&this.removePlayingSoundOldest();var c=l.getWaitingInfo(e,t);if(c)return void c.update(n,o,r,a,s);l.setChannelCurrentCount(e,1);var d=l.getPlayingSoundCache(t);if(d)u.playPlayingSound(n,d,o,r,a,s);else{var h=new egret.Sound;c=new WaitingSoundInfo(e,t,h),c.update(n,o,r,a,s),l._loadingMap[h.hashCode]=c,h.addEventListener(egret.IOErrorEvent.IO_ERROR,l.onIOError,l),h.addEventListener(egret.Event.COMPLETE,l.onLoadSoundComplete,l),h.load(t)}},t.unregisterSound=function(e,t,n,o,r){void 0===o&&(o=0),void 0===r&&(r=!1);var i=this,a=i.getWaitingInfo(e,t,n);if(a)i.setChannelCurrentCount(e,-1),a.sound&&i.removeWaitingInfo(a.sound.hashCode,!0,r);else{var s=i.getPlayer(e);s.stopSound(t,n,o,r)}},t.unregisterChannelSound=function(e,t){void 0===t&&(t=0);var n,o=this,r=[],i=o._loadingMap;for(var a in i)n=i[a],n.channel==e&&r.push(n);for(var s=0,l=r;s<l.length;s++){var u=l[s];u&&u.sound&&(o.setChannelCurrentCount(e,-1),o.removeWaitingInfo(u.sound.hashCode,!0,!0))}var c=o.getPlayer(e);c.stopSound(null,0/0,t,!0)},t.unregisterHashCodeSound=function(e,t,n){void 0===n&&(n=0);var o,r=this,i=[],a=r._loadingMap;for(var s in a)o=a[s],o.channel==e&&o.hashCode==t&&i.push(o);for(var l=0,u=i;l<u.length;l++){var c=u[l];c&&c.sound&&(r.setChannelCurrentCount(e,-1),r.removeWaitingInfo(c.sound.hashCode,!0,!0))}var d=r.getPlayer(e);d.stopSound(null,t,n,!0)},t.stopWaitSound=function(e,t,n,o){void 0===o&&(o=!1);var r=this,i=r.getWaitingInfo(e,t,n);return i?(r.setChannelCurrentCount(e,-1),i.sound&&r.removeWaitingInfo(i.sound.hashCode,!0,o),!0):!1},t.stopPlayingSound=function(e,t,n,o,r){void 0===o&&(o=0),void 0===r&&(r=!1);var i=this.getPlayer(e);i.stopSound(t,n,o,r)},t.changeSoundLoop=function(e,t,n,o){var r=this.getPlayer(e);r.changeSoundLoop(t,n)},t.pauseSound=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=0/0);var o=this.getPlayer(e);o.pauseSound(t,n)},t.resumeSound=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=0/0);var o=this.getPlayer(e);o.resumeSound(t,n)},t.onIOError=function(e){var t=e.target,n=this._loadingMap[t.hashCode];n&&(this.setChannelCurrentCount(n.channel,-1),this.removeWaitingInfo(t.hashCode,!0,!0))},t.onLoadSoundComplete=function(e){var t=e.target,n=this._loadingMap[t.hashCode];if(n){var o=n.url,r=n.hashCode,i=n.volume,a=n.loop,s=n.fadeTime,l=n.callback;
this.removeWaitingInfo(t.hashCode,!1,!1);var u=this.getPlayer(n.channel);u.playSound(o,r,t,i,a,s,l)}},t.getWaitingInfo=function(e,t,n){void 0===n&&(n=0/0);var o,r=this._loadingMap;for(var i in r)if(o=r[i],o.channel==e&&o.url==t&&(isNaN(n)||n==o.hashCode))return o;return null},t.getOldestWaitingInfo=function(e){var t,n,o=this._loadingMap,r=0/0;for(var i in o)t=o[i],t.channel==e&&(isNaN(r)?(r=t.regTime,n=t):r>t.regTime&&(r=t.regTime,n=t));if(!n)for(var i in o)t=o[i],2!=t.channel&&(isNaN(r)?(r=t.regTime,n=t):r>t.regTime&&(r=t.regTime,n=t));return n},t.removeWaitingInfo=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var o=this,r=o._loadingMap,i=r[e];if(i){var a=i.sound;a&&(a.removeEventListener(egret.IOErrorEvent.IO_ERROR,o.onIOError,o),a.removeEventListener(egret.Event.COMPLETE,o.onLoadSoundComplete,o),t&&a.close());var s=i.callback;i.sound=null,i.callback=null,n&&null!=s&&s()}delete r[e]},t.addPlayingSoundCache=function(e,t){if(void 0===t&&(t=3e3),e){var n=e.url,o=this._playingSoundCaches,r=0;for(var i in o)o[i]&&(r+=o[i].length);if(r>=this.maxLimitCount-5)return this.onExecute(),void e.destroy();var a=o[e.url];a||(a=[],o[n]=a),-1==a.indexOf(e)&&(e.delTime=egret.getTimer(),e.delay=t,a.push(e))}},t.getPlayingSoundCache=function(e){var t=this._playingSoundCaches[e];return t&&t.length?t.shift():null},t.removePlayingSoundCache=function(e){if(!e)return!1;var t=egret.getTimer();if(e.delay<0||t<e.delTime+e.delay)return!1;var n=this._playingSoundCaches[e.url];if(!n||!n.length)return delete this._playingSoundCaches[e.url],!1;var o=n.indexOf(e);-1!=o&&n.splice(o,1),e.destroy()},t.onExecute=function(){var e=this._playingSoundCaches,t=null,n=egret.getTimer(),o=[];for(var r in e)if(t=e[r])for(var i=0,a=t;i<a.length;i++){var s=a[i];s.delay>=0&&n>=s.delTime+s.delay&&o.push(s)}for(var l=0,u=o;l<u.length;l++){var c=u[l];this.removePlayingSoundCache(c)}},t.destroySoundGroup=function(e){if(RES.isGroupLoaded(e))for(var t,n=RES.getGroupByName(e),o=0,r=n;o<r.length;o++){var i=r[o];t=RES.getRes(i.name),t instanceof egret.Sound&&t.close()}},t._soundPlayers={},t._loadingMap={},t._playingSoundCaches={},t._channelLimitCounts={},t._channelCurCounts={},t.maxLimitCount=15,t.curSoundCount=0,t}(egret.EventDispatcher);__reflect(SoundPlayer.prototype,"SoundPlayer"),window.SoundPlayer=SoundPlayer;var WaitingSoundInfo=function(){function e(e,t,n){this.channel=0,this.url="",this.hashCode=0,this.volume=1,this.loop=!1,this.fadeTime=0,this.sound=null,this.callback=null,this.regTime=0,this.channel=e,this.url=t,this.sound=n,this.regTime=Date.now()}return e.prototype.update=function(e,t,n,o,r){var i=this;i.hashCode=e,i.volume=t,i.loop=n,i.fadeTime=o,i.callback=r,i.regTime=Date.now()},e}();__reflect(WaitingSoundInfo.prototype,"WaitingSoundInfo"),window.WaitingSoundInfo=WaitingSoundInfo;var GameModel=function(){function e(){this.levelDatas={},this.levelDataList=[],this.maxLevel=1,this.currentLevel=1,this.currentScore=0,this.startTime=0,this.timeId=0,this.boardItemDatas={}}return Object.defineProperty(e.prototype,"isMaxLevel",{get:function(){return this.currentLevel>=this.maxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMaxLevelPass",{get:function(){var e=this.getLevelData(this.maxLevel);return e.isPass},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLevelData",{get:function(){return this.levelDatas[this.currentLevel]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPassLevel",{get:function(){return this.currentScore>=this.currentLevelData.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainTime",{get:function(){return Math.max(0,this.currentLevelData.time-Math.ceil((egret.getTimer()-this.startTime)/1e3))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTimeOut",{get:function(){return this.remainTime<=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeLimit",{get:function(){return this.currentLevelData.time},enumerable:!0,configurable:!0}),e.prototype.setMaxLevel=function(e){this.maxLevel=e},e.prototype.setLevelStatus=function(e,t){var n=this.getLevelData(e);n.isPass=t},e.prototype.setCurrentLevel=function(e){this.currentLevel=e},e.prototype.resetLevel=function(){this.levelDataList.forEach(function(e){e.isPass=!1}),this.currentLevel=1,this.currentScore=0,this.startTime=0,this.timeId=0},e.prototype.setTimeId=function(e){this.timeId=e},e.prototype.addScore=function(e){this.currentScore+=e},e.prototype.clearScore=function(){this.currentScore=0},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.addLevelData=function(e){this.levelDataList.push(e),this.levelDatas[e.level]=e,this.levelDataList.sort(function(e,t){return e.level-t.level})},e.prototype.getLevelData=function(e){return this.levelDatas[e]},e.prototype.addBoardItemData=function(e){this.boardItemDatas[e.idx]=e},e.prototype.getBoardItemData=function(e){return this.boardItemDatas[e]},e.prototype.swapItems=function(e,t){var n=this.boardItemDatas[e];this.boardItemDatas[e]=this.boardItemDatas[t],this.boardItemDatas[t]=n},e.prototype.clearBoard=function(){this.boardItemDatas={}},e}();__reflect(GameModel.prototype,"GameModel");var Functor=function(){function e(){}return e.functor=function(e,t){void 0===t&&(t=null);for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];return e.apply(t||this,n)}},e}();__reflect(Functor.prototype,"Functor");var NumberUtils=function(){function e(){}return e.limit=function(e,t,n){return isNaN(t)&&(t=Number.NEGATIVE_INFINITY),isNaN(n)&&(n=Number.POSITIVE_INFINITY),isNaN(e)?t:(e>n&&(e=n),t>e&&(e=t),e)},e}();__reflect(NumberUtils.prototype,"NumberUtils");var SoundUtils=function(){function e(){}return e.initialize=function(){var e=this;if(!e.initialized){e.initialized=!0,SoundPlayer.maxLimitCount=32;for(var t=e.limitCounts={1:1,2:100},n=1;2>=n;n++)SoundPlayer.setChannelLimitCount(n,t[n]||1);var o=SoundPlayer.getPlayer(2);o.setVolumeRate(.8)}},e.onAppPause=function(){this.onSoundPause()},e.onAppResume=function(){this.onSoundResume()},e.onSoundPause=function(){for(var e=this,t=1;2>=t;t++)e.setMute(t,!0)},e.onSoundResume=function(){var e=this;e.setBgmMute(!1),e.setSoundMute(!1)},e.getVolume=function(e){var t=SoundPlayer.getPlayer(e);return t.settingRate},e.setBgmVolume=function(e,t){void 0===t&&(t=0);var n=SoundPlayer.getPlayer(1);n.setSettingRate(e/100,t)},e.setSoundVolume=function(e,t){void 0===t&&(t=0);var n=SoundPlayer.getPlayer(2);n.setSettingRate(e/100,t)},e.getMute=function(e){var t=SoundPlayer.getPlayer(e);return t.mute},e.setMute=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=.5);var o=SoundPlayer.getPlayer(e);o.setMute(t,n)},e.setBgmMute=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=.5),this.setMute(1,e,t)},e.setSoundMute=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=.5),this.setMute(2,e,t)},e.pauseSound=function(e,t){SoundPlayer.pauseSound(e,null,t)},e.resumeSound=function(e,t){SoundPlayer.resumeSound(e,null,t)},e.stopSoundByChannel=function(e,t){void 0===t&&(t=0),SoundPlayer.unregisterChannelSound(e,t)},e.stopSoundByHashCode=function(e,t,n){void 0===n&&(n=0),SoundPlayer.unregisterHashCodeSound(e,t,n)},e.playSound=function(e,t,n){void 0===n&&(n=!1),this.getMute(2)||SoundPlayer.registerSound(2,Urls.sound(e),t,1,n,!1)},e.stopSound=function(e,t,n){void 0===n&&(n=0),SoundPlayer.unregisterSound(2,Urls.sound(e),t,n)},e.playBGM=function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=1);var r=this,i=r.curBgmName;return e&&i!=e?"0"==e?(i&&r.stopBGM(),void(r.curBgmName=null)):void(this.getMute(1)||(r.curBgmName=e,r.curBgmId=t,SoundPlayer.registerSound(1,Urls.sound(e),t,1,n,!0,o))):void 0},e.stopBGM=function(e){void 0===e&&(e=1),this.curBgmName&&SoundPlayer.unregisterSound(1,Urls.sound(this.curBgmName),this.curBgmId,e)},e.initialized=!1,e}();__reflect(SoundUtils.prototype,"SoundUtils"),window.SoundUtils=SoundUtils;var Urls=function(){function e(){}return e.sound=function(e){return"resource/sound/"+e+".mp3"},e}();__reflect(Urls.prototype,"Urls");var BoardItem=function(e){function t(){var t=e.call(this)||this;return t.isAdded=!1,t.isLock=!1,t.touchStartX=0,t.touchStartY=0,t.MIN_SWIPE_DISTANCE=10,t.skinName="BoardItemSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.isAdded&&!!this.data},enumerable:!0,configurable:!0}),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.updateBoardItem()},t.prototype.$onAddToStage=function(t,n){e.prototype.$onAddToStage.call(this,t,n),this.isAdded=!0,this.isLock=!1,this.updateBoardItem()},t.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),egret.Tween.removeTweens(this.icon),this.isAdded=!1,this.isLock=!1,this.icon.scaleX=1,this.icon.scaleY=1,this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),ProcessController.instance.root.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.onTouchBegin=function(t){e.prototype.onTouchBegin.call(this,t);var n=this;SoundUtils.playSound("click_01",this.hashCode),n.isLock||ProcessController.instance.game.isPlaying&&(ProcessController.instance.game.isLock||(this.touchStartX=t.stageX,this.touchStartY=t.stageY,n.isLock=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),ProcessController.instance.root.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.Tween.get(n.icon).to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},150,egret.Ease.backInOut).call(function(){n.isLock=!1})))},t.prototype.onTouchEnd=function(e){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),ProcessController.instance.root.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this);var t=e.stageX-this.touchStartX,n=e.stageY-this.touchStartY,o=Math.sqrt(t*t+n*n);if(!(o<this.MIN_SWIPE_DISTANCE)){var r=180*Math.atan2(n,t)/Math.PI;r=0>r?r+360:r;var i=0,a=0;if(r>=315||45>r){if(8==this.data.col)return;i=this.data.row,a=this.data.col+1}else if(r>=45&&135>r){if(8==this.data.row)return;i=this.data.row+1,a=this.data.col}else if(r>=135&&225>r){if(0==this.data.col)return;i=this.data.row,a=this.data.col-1}else{if(0==this.data.row)return;i=this.data.row-1,a=this.data.col}ProcessController.instance.game.swapBoardItem(this.data.idx,i,a)}},t.prototype.updateBoardItem=function(){this.isReady&&(this.icon.source=this.data.color>0?this.data.color+"_png":"")},t.prototype.dispose=function(){egret.Tween.removeTweens(this),this.icon&&(egret.Tween.removeTweens(this.icon),this.icon.scaleX=1,this.icon.scaleY=1),this.isLock=!1,this.data=null,this.parent&&this.parent.removeChild(this)},t}(eui.ItemRenderer);__reflect(BoardItem.prototype,"BoardItem");var GameUI=function(e){function t(){var t=e.call(this)||this;return t.top=t.bottom=t.left=t.right=0,t.skinName="GameSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.updateUI()},t.prototype.updateUI=function(){this.updateLevel(),this.updateScore(),this.updateTimeLimit()},t.prototype.updateLevel=function(){this.currentLevelLabel&&(this.currentLevelLabel.text="当前关卡: "+ProcessController.instance.game.currentLevel)},t.prototype.updateScore=function(){if(this.currentScoreLabel){var e=ProcessController.instance.game;this.currentScoreLabel.text="当前积分: "+e.currentScore+"/"+e.targetScore}},t.prototype.updateTimeLimit=function(){if(this.timeLimitLabel){var e=ProcessController.instance.game.remainTime,t=Math.floor(e/60),n=e%60;this.timeLimitLabel.text=(10>t?"0"+t:t)+":"+(10>n?"0"+n:n)}},t.prototype.createBoardItems=function(){for(var e=0;9>e;e++)for(var t=0;9>t;t++)this.createBoardItem(e,t)},t.prototype.createBoardItem=function(e,t){var n=ProcessController.instance.game,o=9*e+t,r=n.getBoardItemData(o),i=n.createBoardItem();i.data=r,i.x=64*t,i.y=64*e,r.updateBoardItem(i),this.group.addChild(i)},t}(eui.Component);__reflect(GameUI.prototype,"GameUI");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.top=t.bottom=t.left=t.right=0,t.skinName="LoadingSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n),n===this.progressBar&&(this.progressBar.minimum=0,this.progressBar.maximum=100,this.progressBar.value=0)},t.prototype.onProgress=function(e,t){var n=Math.floor(e/t*100);this.progressBar&&(this.progressBar.value=n),this.progressLabel&&(this.progressLabel.text=n+"%")},t}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var LoginUI=function(e){function t(){var t=e.call(this)||this;return t.top=t.bottom=t.left=t.right=0,t.skinName="LoginSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.resetButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this),this.updateUI()},t.prototype.onStart=function(){ProcessController.instance.startGame()},t.prototype.onReset=function(){ProcessController.instance.resetLevel()},t.prototype.updateUI=function(){this.updateVersionLabel(),this.updateCurrentLevelLabel()},t.prototype.updateVersionLabel=function(){this.versionLabel&&(this.versionLabel.text="Version: "+ProcessController.instance.version)},t.prototype.updateCurrentLevelLabel=function(){if(this.currentLevelLabel){var e=ProcessController.instance.game;e.isMaxLevelPass?(this.currentLevelLabel.text="已通关",this.startButton.visible=!1,this.resetButton.visible=!0):(this.currentLevelLabel.text="当前等级: "+e.currentLevel,this.startButton.visible=!0,this.resetButton.visible=!1)}},t}(eui.Component);__reflect(LoginUI.prototype,"LoginUI");var ResultUI=function(e){function t(){var t=e.call(this)||this;return t.isReady=!1,t.isDataReady=!1,t.level=0,t.isPass=!1,t.top=t.bottom=t.left=t.right=0,t.skinName="ResultSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.isReady=!0,this.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this),this.restartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this.exitButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.updateUI()},t.prototype.updateUI=function(){this.isReady&&this.isDataReady&&(this.level==ProcessController.instance.game.maxLevel?(this.resultLabel.text="恭喜你！已全部通关！",this.nextButton.visible=!1,this.restartButton.visible=!1,this.exitButton.visible=!0):this.isPass?(this.resultLabel.text="恭喜你！通关第"+this.level+"关！",this.nextButton.visible=!0,this.restartButton.visible=!1,this.exitButton.visible=!1):(this.resultLabel.text="很遗憾！第"+this.level+"关未通关！",this.nextButton.visible=!1,this.restartButton.visible=!0,this.exitButton.visible=!1))},t.prototype.setResultData=function(e,t){this.isDataReady=!0,this.level=e,this.isPass=t,this.updateUI()},t.prototype.onNext=function(){ProcessController.instance.nextLevel()},t.prototype.onRestart=function(){ProcessController.instance.replayGame()},t.prototype.onExit=function(){ProcessController.instance.exitGame()},t}(eui.Component);__reflect(ResultUI.prototype,"ResultUI");